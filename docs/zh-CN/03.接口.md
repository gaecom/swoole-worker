# 接口

## 基本接口

* sendToClient(string $client, string $message)
* sendToUid(string $uid, string $message, array $without_client_list = [])
  * without_client_list 排除这些客户端
* sendToGroup(string $group, string $message, array $without_client_list = [])
  * without_client_list 排除这些客户端
* sendToAll(string $message, array $without_client_list = [])
  * without_client_list 排除这些客户端
* isOnline(string $client)
* isUidOnline(string $uid): bool
  * 任何一个绑定了指定uid的客户端在线就返回`true`
* getClientListByGroup(string $group, string $prev_client = null): iterable
  * prev_client 从该客户端开始读取 默认不填就好
* getClientCount(): int
* getClientCountByGroup(string $group): int
* getClientList(string $prev_client = null): iterable
* getClientListByUid(string $uid, string $prev_client = null): iterable
  * prev_client 从该客户端开始读取 默认不填就好
* getClientInfo(string $client, int $type = 255): array
* getUidListByGroup(string $group, bool $unique = true): iterable
* getUidList(bool $unique = true): iterable
* getUidCount(float $unique_percent = null): int
* getGroupList(bool $unique = true): iterable
* getUidCountByGroup(string $group): int
  * 返回的是一个近似值
* closeClient(string $client, bool $force = false)
* bindUid(string $client, string $uid)
* unBindUid(string $client)
* joinGroup(string $client, string $group)
* leaveGroup(string $client, string $group)
* unGroup(string $group)
* setSession(string $client, array $session)
  * 赋值 注意和updateSession区分
* updateSession(string $client, array $session)
  * 合并 merge
* deleteSession(string $client)
* getSession(string $client): ?array
* sendToAddressListAndRecv(array $items, float $timeout = 1): array
* sendToAddressAndRecv(array $address, string $buffer, float $timeout = 1): string
* sendToAddress(array $address, string $buffer, $timeout = 1)

以上接口能够应对大多数场景，若不能满足需求，也提供自定义命令，详见自定义命令章节。

以上命令很好理解，不做赘述，部分接口稍作解释

## UID相关

一个client只能绑定一个uid，一个uid可以被多个client绑定，常见场景比如qq微信的多端登录

多次绑定以最后一次操作为准

`isUidOnline`指的是有任何一个绑定了指定uid的客户端在线就返回`true`

client断开会自动解绑uid，无需手动解绑

## Group相关

一个客户端可以加入多个group，一个group可以被多个client加入，为多对多关系

client断开会自动退出已经加入的group

group无人的时候会自动删除group

`getUidCountByGroup`并不是一个精确数字

## Session相关

每次消息事件都会得到客户端的session，无需通过`getSession`获取当前客户端的session，`getSession`通常是获取的其他客户端的session或者较长时间后session有变化重新获取。

修改session只能通过接口`setSession`、`updateSession`、`deleteSession`等修改。

`setSession`是直接赋值，`updateSession`是合并，内部是merge逻辑

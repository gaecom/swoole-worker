# 接口

## 基本接口

* sendToClient(string $client, string $message)
* sendToUid(string $uid, string $message)
* sendToGroup(string $group, string $message, array $without_client_list = [])
* sendToAll(string $message, array $without_client_list = [])
* isOnline(string $client)
* isUidOnline(string $uid): bool
* getClientListByGroup(string $group, string $prev_client = null): iterable
* getClientCount(): int
* getClientCountByGroup(string $group): int
* getClientList(string $prev_client = null): iterable
* getClientListByUid(string $uid, string $prev_client = null): iterable
* getClientInfo(string $client, int $type = 255): array
* getUidListByGroup(string $group, bool $unique = true): iterable
* getUidList(bool $unique = true): iterable
* getUidCount(float $unique_percent = null): int
* getGroupList(bool $unique = true): iterable
* getUidCountByGroup(string $group): int
* closeClient(string $client, bool $force = false)
* bindUid(string $client, string $uid)
* unBindUid(string $client)
* joinGroup(string $client, string $group)
* leaveGroup(string $client, string $group)
* unGroup(string $group)
* setSession(string $client, array $session)
* updateSession(string $client, array $session)
* deleteSession(string $client)
* getSession(string $client): ?array
* sendToAddressListAndRecv(array $items, float $timeout = 1): array
* sendToAddressAndRecv(array $address, string $buffer, float $timeout = 1): string
* sendToAddress(array $address, string $buffer, $timeout = 1)

以上命令不做详细说明，很好理解。

## 自定义命令

以上接口能够应对大多数场景，若不能满足需求，也提供自定义命令，自定义命令在gateway服务初始化的时候传入，请看下面代码：

``` php
<?php

declare(strict_types=1);

use Xielei\Swoole\Gateway;

require_once __DIR__ . '/../vendor/autoload.php';

$gateway = new Gateway();

// 定义一个命令类，命令必须继承Xielei\Swoole\Interfaces\CmdInterface
class DemoCmd implements Xielei\Swoole\Interfaces\CmdInterface
{
    public static function getCommandCode(): int
    {
        return 100;
    }

    public static function execute(
        Xielei\Swoole\Gateway $gateway,
        Swoole\Coroutine\Server\Connection $conn,
        string $buffer
    ) {
        // 收到命令后，执行自己的业务逻辑
        // 请完善代码...
        // var_dump($buffer) 'hello, this is demo cmd..'
    }
}

// 将命令注册到gateway
$gateway->registerCommand(DemoCmd::class);

$gateway->listen('127.0.0.1', 8000);

$gateway->start();
```

在worker里面定义一个方法，调用该方法，即可向gateway发送自定义命令

``` php
<?php

use Xielei\Swoole\Helper\WorkerEvent as HelperWorkerEvent;

class WorkerEvent extends HelperWorkerEvent
{
    public function onConnect(string $client)
    {
        $this->execDemoCmd($client, 'hello, this is demo cmd..');
    }
    
    private function execDemoCmd(string $client, string $data)
    {
        $buffer = pack('C', DemoCmd::getCommandCode()) . $data;
        Api::sendToAddress(Api::clientToAddress($client), $buffer);
    }
}
```

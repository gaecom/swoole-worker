# 入门示例

## Register服务

register.php

``` php
<?php

declare(strict_types=1);

use Xielei\Swoole\Register;

require_once __DIR__ . '/../vendor/autoload.php';

$register = new Register();

$register->start();

```

## Gateway服务

gateway.php

```php
<?php

declare(strict_types=1);

use Xielei\Swoole\Gateway;

require_once __DIR__ . '/../vendor/autoload.php';

$gateway = new Gateway();

// 监听tcp
$gateway->listen('127.0.0.1', 8000);

$gateway->start();

```

## Worker服务

worker.php

```php
<?php

declare(strict_types=1);

use Xielei\Swoole\Worker;

require_once __DIR__ . '/vendor/autoload.php';

$worker = new Worker();

// 定义工作加载文件，该文件在reload的时候会重新加载，也是我们的主要开发文件
$worker->worker_file = __DIR__ . '/event_worker.php';

$worker->$worker->start();

```

event_worker.php

``` php
<?php

declare(strict_types=1);

use Xielei\Swoole\Api;
use Xielei\Swoole\Helper\WorkerEvent as HelperWorkerEvent;

class WorkerEvent extends HelperWorkerEvent
{
    public function onConnect(string $client, array $session)
    {
        Api::sendToClient($client, "hello {$client}.\n");
    }

    public function onReceive(string $client, array $session, string $data)
    {
        Api::sendToClient($client, "{$client} say {$data}\n");
    }
}
```

## 启动服务

``` bash
[root@VM-0-17-centos worker]# php register.php start -d
the service is running with daemonize~
[root@VM-0-17-centos worker]# 
```

worker.php和gateway.php也需要启动，方法一样，不再赘述。

## 测试

可以使用telnet进行调试测试：

``` bash
[root@VM-0-17-centos worker]# telnet 127.0.0.1 8000
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
hello 7f000001239400000002.
wow~
7f000001239400000002 say wow~
nice..     
7f000001239400000002 say nice..
```
